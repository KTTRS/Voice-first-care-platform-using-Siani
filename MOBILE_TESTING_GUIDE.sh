#!/bin/bash

# Mobile Testing Guide for Siani Voice Conversation

echo "üì± Siani Mobile Testing Guide"
echo "============================="
echo ""

echo "üéØ Prerequisites:"
echo "  ‚úÖ Backend running (./dev.sh)"
echo "  ‚úÖ OpenAI API key configured"
echo "  ‚úÖ Expo Go app installed on your phone"
echo ""

echo "üì≤ Option 1: Test on Physical Device (Recommended)"
echo "--------------------------------------------------"
echo ""
echo "1. Install Expo Go app:"
echo "   ‚Ä¢ iOS: https://apps.apple.com/app/expo-go/id982107779"
echo "   ‚Ä¢ Android: https://play.google.com/store/apps/details?id=host.exp.exponent"
echo ""
echo "2. Start mobile development server:"
echo "   cd packages/mobile"
echo "   npm start"
echo ""
echo "3. Scan QR code with:"
echo "   ‚Ä¢ iOS: Camera app"
echo "   ‚Ä¢ Android: Expo Go app"
echo ""
echo "4. Navigate to Siani screen and test voice recording"
echo ""

echo "üíª Option 2: Test on Simulator/Emulator"
echo "----------------------------------------"
echo ""
echo "iOS Simulator:"
echo "   cd packages/mobile"
echo "   npm run ios"
echo ""
echo "Android Emulator:"
echo "   cd packages/mobile"
echo "   npm run android"
echo ""

echo "üé§ Testing Voice Features:"
echo "-------------------------"
echo ""
echo "1. Login with test account:"
echo "   Email: john.doe@example.com"
echo "   Password: patient123"
echo ""
echo "2. Navigate to Siani screen (modal)"
echo ""
echo "3. Test voice recording:"
echo "   ‚Ä¢ Tap and hold 'Tap to speak' button"
echo "   ‚Ä¢ Speak clearly"
echo "   ‚Ä¢ Release to send"
echo "   ‚Ä¢ Wait for Siani's response"
echo "   ‚Ä¢ Audio should auto-play"
echo ""
echo "4. Verify:"
echo "   ‚úÖ Transcription accuracy"
echo "   ‚úÖ Emotion detection (color indicator)"
echo "   ‚úÖ Voice response plays automatically"
echo "   ‚úÖ Conversation history persists"
echo "   ‚úÖ Avatar reacts to emotion"
echo ""

echo "üêõ Troubleshooting:"
echo "------------------"
echo ""
echo "Issue: 'Network request failed'"
echo "  ‚Üí Check backend is running: curl http://localhost:3000/health"
echo "  ‚Üí Update EXPO_PUBLIC_API_URL in packages/mobile/.env"
echo "  ‚Üí For physical device, use your computer's IP:"
echo "    EXPO_PUBLIC_API_URL=http://YOUR_IP:3000"
echo ""
echo "Issue: 'Microphone permission denied'"
echo "  ‚Üí Allow microphone access in phone settings"
echo "  ‚Üí Restart Expo Go app"
echo ""
echo "Issue: 'Failed to synthesize speech'"
echo "  ‚Üí Check OpenAI API key in backend/.env"
echo "  ‚Üí Check backend logs: tail -f backend.log"
echo ""

echo "üìä Backend Monitoring:"
echo "---------------------"
echo ""
echo "Watch backend logs:"
echo "  tail -f backend.log | grep -E '(Siani|TTS|emotion)'"
echo ""
echo "Test API directly:"
echo "  bash test-siani-conversation.sh"
echo ""

echo "üé® Mobile App Features to Test:"
echo "-------------------------------"
echo ""
echo "‚úÖ Voice Recording"
echo "   ‚Ä¢ Press and hold to record"
echo "   ‚Ä¢ Visual feedback (pulse animation)"
echo "   ‚Ä¢ Haptic feedback on press/release"
echo ""
echo "‚úÖ Emotion Detection"
echo "   ‚Ä¢ CALM = Teal dot"
echo "   ‚Ä¢ GUARDED = Pink dot"
echo "   ‚Ä¢ LIT = Gold dot"
echo ""
echo "‚úÖ Audio Playback"
echo "   ‚Ä¢ Automatic playback of Siani's response"
echo "   ‚Ä¢ Base64 audio data URL"
echo ""
echo "‚úÖ Conversation UI"
echo "   ‚Ä¢ User messages (right, dark gray)"
echo "   ‚Ä¢ Siani messages (left, purple glow)"
echo "   ‚Ä¢ Scrolls to latest message"
echo ""
echo "‚úÖ Avatar"
echo "   ‚Ä¢ Emotion-aware animations"
echo "   ‚Ä¢ Size: 120px"
echo "   ‚Ä¢ Centered at top"
echo ""

echo "üöÄ Next Steps After Testing:"
echo "----------------------------"
echo ""
echo "1. Add WebSocket streaming for real-time audio"
echo "2. Implement waveform visualization during recording"
echo "3. Add haptic feedback patterns for different emotions"
echo "4. Enable background recording"
echo "5. Add offline queue for messages"
echo "6. Implement streak tracking"
echo ""

echo "üí° Quick Start:"
echo "--------------"
echo "  cd packages/mobile"
echo "  npm start"
echo ""
echo "Then scan QR code with Expo Go app!"
